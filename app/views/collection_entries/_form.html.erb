<div class="border-1 rounded-2xl bg-blue-200 justify-items-center">
  <%= form_with model: @collection_entry do |collection_entry_form| %>
    <% if collection_entry.errors.any? %>
      <div style="color: red">
        <h2><%= pluralize(collection_entry.errors.count, "error") %> prohibited this collection_entry from being saved:</h2>

        <ul>
          <% collection_entry.errors.each do |error| %>
            <li><%= error.full_message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <br/>
    <div>
      <%= collection_entry_form.label :user_id, "COLLECTOR", class:'text-blue-700 font-bold' %>
      <%= collection_entry_form.select :user_id, User.all.collect { |person| [ person.display_name, person.id ] }, include_blank: true %>

    </div>
    <br/>
    
    <div class='my-4 flex flex-col'
        data-controller='nested-form'
        data-nested-form-pattern-to-replace-with-index-value='EGG_ENTRY_INDEX'
    >
      <template data-nested-form-target="formTemplate">

          <%= collection_entry_form.fields_for :egg_entries, EggEntry.new, child_index: "EGG_ENTRY_INDEX" do |ee_form| %>
            <%= ee_form.label :chicken_id, "Chicken: " %>
            <%= ee_form.collection_select :chicken_id, @chickens, :id, :name %>

            <%= ee_form.label :egg_count, "Egg Count: " %>
            <%= ee_form.text_field :egg_count %>
            <br/>

                <% if ee_form.object.persisted? %>
                  <br/><label class="flex gap-2 text-sm text-red-500">
                    <%= ee_form.check_box :_destroy %>
                    <span>remove</span>
                  </label>
                <% end %>
          <% end %>
        </template>
        <div class="text-right">
          <span class="btn-primary cursor-pointer btn-sm" data-action="click->nested-form#addItem">Add egg entry</span>
        </div>
        <div data-nested-form-target="itemsList">
          <%= collection_entry_form.fields_for(:egg_entries) do |ee_form| %>
          <!--REWORK - abstract this into a form partial-->
            <%= ee_form.label :chicken_id, "Chicken: " %>
            <%= ee_form.collection_select :chicken_id, @chickens, :id, :name %>

            <%= ee_form.label :egg_count, "Egg Count: " %>
            <%= ee_form.text_field :egg_count %>
            <br/>

                <% if ee_form.object.persisted? %>
                  <br/><label class="flex gap-2 text-sm text-red-500">
                    <%= ee_form.check_box :_destroy %>
                    <span>remove</span>
                  </label>
                <% end %>
          <% end %>
        </div>
    </div>

    
    <div class="inline">
      <%= collection_entry_form.submit class: 'bg-yellow-300' %>
    </div>
  <% end %>

  <br/><br/>
</div>
